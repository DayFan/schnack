!function(){"use strict";function n(){}function e(e,t){var r=new n;if(e instanceof n)e.each(function(n,e){r.set(e,n)});else if(Array.isArray(e)){var o,u=-1,i=e.length;if(null==t)for(;++u<i;)r.set(u,e[u]);else for(;++u<i;)r.set(t(o=e[u],u,e),o)}else if(e)for(var a in e)r.set(a,e[a]);return r}function t(){for(var n,e=arguments,t=0,o=arguments.length,u={};t<o;++t){if(!(n=e[t]+"")||n in u)throw new Error("illegal type: "+n);u[n]=[]}return new r(u)}function r(n){this._=n}function o(n,e){return n.trim().split(/^|\s+/).map(function(n){var t="",r=n.indexOf(".");if(r>=0&&(t=n.slice(r+1),n=n.slice(0,r)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:t}})}function u(n,e){for(var t,r=0,o=n.length;r<o;++r)if((t=n[r]).name===e)return t.value}function i(n,e,t){for(var r=0,o=n.length;r<o;++r)if(n[r].name===e){n[r]=p,n=n.slice(0,r).concat(n.slice(r+1));break}return null!=t&&n.push({name:e,value:t}),n}function a(n){return function(e,t){n(null==e?t:null)}}function c(n){var e=n.responseType;return e&&"text"!==e?n.response:n.responseText}function s(n){return new Function("d","return {"+n.map(function(n,e){return JSON.stringify(n)+": d["+e+"]"}).join(",")+"}")}function l(n,e){var t=s(n);return function(r,o){return e(t(r),o,n)}}function f(n){var e=Object.create(null),t=[];return n.forEach(function(n){for(var r in n)r in e||t.push(e[r]=r)}),t}n.prototype=e.prototype={constructor:n,has:function(n){return"$"+n in this},get:function(n){return this["$"+n]},set:function(n,e){return this["$"+n]=e,this},remove:function(n){var e="$"+n;return e in this&&delete this[e]},clear:function(){var n=this;for(var e in n)"$"===e[0]&&delete n[e]},keys:function(){var n=this,e=[];for(var t in n)"$"===t[0]&&e.push(t.slice(1));return e},values:function(){var n=this,e=[];for(var t in n)"$"===t[0]&&e.push(n[t]);return e},entries:function(){var n=this,e=[];for(var t in n)"$"===t[0]&&e.push({key:t.slice(1),value:n[t]});return e},size:function(){var n=this,e=0;for(var t in n)"$"===t[0]&&++e;return e},empty:function(){var n=this;for(var e in n)if("$"===e[0])return!1;return!0},each:function(n){var e=this;for(var t in e)"$"===t[0]&&n(e[t],t.slice(1),e)}};var p={value:function(){}};r.prototype=t.prototype={constructor:r,on:function(n,e){var t,r=this._,a=o(n+"",r),c=-1,s=a.length;{if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++c<s;)if(t=(n=a[c]).type)r[t]=i(r[t],n.name,e);else if(null==e)for(t in r)r[t]=i(r[t],n.name,null);return this}for(;++c<s;)if((t=(n=a[c]).type)&&(t=u(r[t],n.name)))return t}},copy:function(){var n={},e=this._;for(var t in e)n[t]=e[t].slice();return new r(n)},call:function(n,e){var t=arguments;if((r=arguments.length-2)>0)for(var r,o,u=new Array(r),i=0;i<r;++i)u[i]=t[i+2];if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(i=0,r=(o=this._[n]).length;i<r;++i)o[i].value.apply(e,u)},apply:function(n,e,t){if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(var r=this._[n],o=0,u=r.length;o<u;++o)r[o].value.apply(e,t)}};var h=function(n,r){function o(n){var e,t=h.status;if(!t&&c(h)||t>=200&&t<300||304===t){if(s)try{e=s.call(u,h)}catch(n){return void f.call("error",u,n)}else e=h;f.call("load",u,e)}else f.call("error",u,n)}var u,i,s,l,f=t("beforesend","progress","load","error"),p=e(),h=new XMLHttpRequest,v=null,d=null,m=0;if("undefined"==typeof XDomainRequest||"withCredentials"in h||!/^(http(s)?:)?\/\//.test(n)||(h=new XDomainRequest),"onload"in h?h.onload=h.onerror=h.ontimeout=o:h.onreadystatechange=function(n){h.readyState>3&&o(n)},h.onprogress=function(n){f.call("progress",u,n)},u={header:function(n,e){return n=(n+"").toLowerCase(),arguments.length<2?p.get(n):(null==e?p.remove(n):p.set(n,e+""),u)},mimeType:function(n){return arguments.length?(i=null==n?null:n+"",u):i},responseType:function(n){return arguments.length?(l=n,u):l},timeout:function(n){return arguments.length?(m=+n,u):m},user:function(n){return arguments.length<1?v:(v=null==n?null:n+"",u)},password:function(n){return arguments.length<1?d:(d=null==n?null:n+"",u)},response:function(n){return s=n,u},get:function(n,e){return u.send("GET",n,e)},post:function(n,e){return u.send("POST",n,e)},send:function(e,t,r){return h.open(e,n,!0,v,d),null==i||p.has("accept")||p.set("accept",i+",*/*"),h.setRequestHeader&&p.each(function(n,e){h.setRequestHeader(e,n)}),null!=i&&h.overrideMimeType&&h.overrideMimeType(i),null!=l&&(h.responseType=l),m>0&&(h.timeout=m),null==r&&"function"==typeof t&&(r=t,t=null),null!=r&&1===r.length&&(r=a(r)),null!=r&&u.on("error",r).on("load",function(n){r(null,n)}),f.call("beforesend",u,h),h.send(null==t?null:t),u},abort:function(){return h.abort(),u},on:function(){var n=f.on.apply(f,arguments);return n===f?u:n}},null!=r){if("function"!=typeof r)throw new Error("invalid callback: "+r);return u.get(r)}return u},v=function(n,e){return function(t,r){var o=h(t).mimeType(n).response(e);if(null!=r){if("function"!=typeof r)throw new Error("invalid callback: "+r);return o.get(r)}return o}};v("text/html",function(n){return document.createRange().createContextualFragment(n.responseText)});var d=v("application/json",function(n){return JSON.parse(n.responseText)});v("text/plain",function(n){return n.responseText}),v("application/xml",function(n){var e=n.responseXML;if(!e)throw new Error("parse error");return e});var m={},y={},g=34,w=10,k=13,b=function(n){function e(n,e){function t(){if(s)return y;if(l)return l=!1,m;var e,t,r=a;if(n.charCodeAt(r)===g){for(;a++<i&&n.charCodeAt(a)!==g||n.charCodeAt(++a)===g;);return(e=a)>=i?s=!0:(t=n.charCodeAt(a++))===w?l=!0:t===k&&(l=!0,n.charCodeAt(a)===w&&++a),n.slice(r+1,e-1).replace(/""/g,'"')}for(;a<i;){if((t=n.charCodeAt(e=a++))===w)l=!0;else if(t===k)l=!0,n.charCodeAt(a)===w&&++a;else if(t!==u)continue;return n.slice(r,e)}return s=!0,n.slice(r,i)}var r,o=[],i=n.length,a=0,c=0,s=i<=0,l=!1;for(n.charCodeAt(i-1)===w&&--i,n.charCodeAt(i-1)===k&&--i;(r=t())!==y;){for(var f=[];r!==m&&r!==y;)f.push(r),r=t();e&&null==(f=e(f,c++))||o.push(f)}return o}function t(e){return e.map(r).join(n)}function r(n){return null==n?"":o.test(n+="")?'"'+n.replace(/"/g,'""')+'"':n}var o=new RegExp('["'+n+"\n\r]"),u=n.charCodeAt(0);return{parse:function(n,t){var r,o,u=e(n,function(n,e){if(r)return r(n,e-1);o=n,r=t?l(n,t):s(n)});return u.columns=o,u},parseRows:e,format:function(e,t){return null==t&&(t=f(e)),[t.map(r).join(n)].concat(e.map(function(e){return t.map(function(n){return r(e[n])}).join(n)})).join("\n")},formatRows:function(n){return n.map(t).join("\n")}}},T=(b(","),b("\t"),function(n){var e,t="";return n.user?t+='\n<div class="schnack-form">\n    <textarea class="schnack-body"></textarea><br>\n    <button class="schnack-button">Send comment</button>\n</div>\n':t+='\n<button class="schnack-login-twitter">Login with Twitter to post comment</button>\n',t+='\n<ul class="schnack-comments">\n    ',n.comments.forEach(function(n){t+='\n        <li class="schnack-comment">\n            <div class="schnack-author">\n                '+(null==(e=n.name)?"":e)+' <span class="schnack-date">'+(null==(e=n.created_at_s)?"":e)+'</span>\n            </div>\n            <blockquote class="schnack-body">\n                <p>'+(null==(e=n.comment)?"":e)+"</p>\n            </blockquote>\n        </li>\n    "}),t+="\n</ul>"});!function(){function n(){d(u,function(t,r){t&&console.error(t),console.log(r),e(i).innerHTML=T(r),e(i+" .schnack-button").addEventListener("click",function(t){var r={comment:e(i+" .schnack-body").value};h(u).on("beforesend",function(n){n.withCredentials=!0}).mimeType("application/json").header("Content-Type","application/json").post(JSON.stringify(r),function(e,t){e&&console.error(e),console.log(t),n()})})}).on("beforesend",function(n){n.withCredentials=!0})}var e=function(n){return document.querySelector(n)},t=e("script[data-schnack-target]");if(!t)return console.warn("schnack script tag needs some data attributes");var r=t.dataset,o=r.schnackSlug,u=r.schnackHost+"/comments/"+o,i=r.schnackTarget;n()}()}();
