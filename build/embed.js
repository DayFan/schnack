!function(){"use strict";var n="function"==typeof fetch?fetch.bind():function(n,e){return e=e||{},new Promise(function(t,s){function a(){var n,e=[],t=[],s={};return o.getAllResponseHeaders().replace(/^(.*?):\s*([\s\S]*?)$/gm,function(a,o,c){e.push(o=o.toLowerCase()),t.push([o,c]),n=s[o],s[o]=n?n+","+c:c}),{ok:1==(o.status/200|0),status:o.status,statusText:o.statusText,url:o.responseURL,clone:a,text:function(){return Promise.resolve(o.responseText)},json:function(){return Promise.resolve(o.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([o.response]))},headers:{keys:function(){return e},entries:function(){return t},get:function(n){return s[n.toLowerCase()]},has:function(n){return n.toLowerCase()in s}}}}var o=new XMLHttpRequest;o.open(e.method||"get",n);for(var c in e.headers)o.setRequestHeader(c,e.headers[c]);o.withCredentials="include"==e.credentials,o.onload=function(){t(a())},o.onerror=s,o.send(e.body)})},e=function(n){var e,t="";return n.user?t+='\n<div class="schnack-form">\n    <textarea class="schnack-body" placeholder="Post a comment. Markdown is supported!"></textarea><br>\n    <button class="schnack-button">Send comment</button>\n    (signed in as <span class="schnack-user">@'+(null==(e=n.user.name)?"":e)+'</span> :: <a class="schnack-signout" href="#">sign out</a>)\n</div>\n':(t+="\nTo post a comment you need to sign in via<br>\n",n.auth.forEach(function(n,s){t+="\n    "+(null==(e=s?" or ":"")?"":e)+'<button class="schnack-signin-'+(null==(e=n.id)?"":e)+'">'+(null==(e=n.name)?"":e)+"</button>\n"}),t+="\n"),t+='\n<ul class="schnack-comments">\n    ',n.comments.forEach(function(s){t+='\n        <li class="schnack-comment',s.approved||(t+=" schnack-not-approved"),t+='">\n            <div class="schnack-dateline">\n                <span class="schnack-author">'+(null==(e=s.name)?"":e)+'</span>\n                <span class="schnack-date">'+(null==(e=s.created_at_s)?"":e)+':</span>\n            </div>\n            <blockquote class="schnack-body">\n                <p>'+(null==(e=s.comment)?"":e)+"</p>\n            </blockquote>\n            ",s.approved||(t+='\n            <div class="schnack-awaiting-approval">\n                This comment is still waiting for '+(null==(e=n.user.admin?"your ":"")?"":e)+"approval"+(null==(e=n.user.admin?"":" by the site owner")?"":e)+".\n                ",n.user.admin&&["approve","reject"].forEach(function(n){t+='\n                <button class="schnack-action" data-target="'+(null==(e=s.id)?"":e)+'" data-class="comment" data-action="'+(null==(e=n)?"":e)+'">'+(null==(e=n)?"":e)+"</button>\n                "}),t+="\n            </div>\n            "),t+="\n        </li>\n    "}),t+="\n</ul>"};!function(){function t(){n(u,{credentials:"include",headers:{"Content-Type":"application/json"}}).then(function(n){return n.json()}).then(function(a){s(l).innerHTML=e(a);var o=s(l+" .schnack-button");if(o&&o.addEventListener("click",function(e){var a={comment:s(l+" .schnack-body").value};n(u,{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(function(n){return n.json()}).then(function(n){console.log(n),t()})}),a.user){var c=s("a.schnack-signout");c&&c.addEventListener("click",function(e){e.preventDefault(),n(i+"/signout",{credentials:"include",headers:{"Content-Type":"application/json"}}).then(function(n){return n.json()}).then(function(n){console.log(n),t()})})}else a.auth.forEach(function(n){var e=s(l+" .schnack-signin-"+n.id);e&&e.addEventListener("click",function(e){window.open(i+"/auth/"+n.id,n.name+" Sign-In","resizable,scrollbars,status,width=600,height=500").onbeforeunload=t})});if(a.user&&a.user.admin){var r=function(e){var s=e.target.dataset;n(i+"/"+s.class+"/"+s.target+"/"+s.action,{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:""}).then(function(n){return n.json()}).then(function(n){console.log(n),t()})};document.querySelectorAll(".schnack-action").forEach(function(n){n.addEventListener("click",r)})}})}var s=function(n){return document.querySelector(n)},a=s("script[data-schnack-target]");if(!a)return console.warn("schnack script tag needs some data attributes");var o=a.dataset,c=o.schnackSlug,r=new URL(a.getAttribute("src")),i=r.protocol+"//"+r.host,u=i+"/comments/"+c,l=o.schnackTarget;t()}()}();
