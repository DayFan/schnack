!function(){"use strict";function n(){}function t(t,e){var r=new n;if(t instanceof n)t.each(function(n,t){r.set(t,n)});else if(Array.isArray(t)){var o,u=-1,i=t.length;if(null==e)for(;++u<i;)r.set(u,t[u]);else for(;++u<i;)r.set(e(o=t[u],u,t),o)}else if(t)for(var a in t)r.set(a,t[a]);return r}function e(){for(var n,t=arguments,e=0,o=arguments.length,u={};e<o;++e){if(!(n=t[e]+"")||n in u)throw new Error("illegal type: "+n);u[n]=[]}return new r(u)}function r(n){this._=n}function o(n,t){return n.trim().split(/^|\s+/).map(function(n){var e="",r=n.indexOf(".");if(r>=0&&(e=n.slice(r+1),n=n.slice(0,r)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:e}})}function u(n,t){for(var e,r=0,o=n.length;r<o;++r)if((e=n[r]).name===t)return e.value}function i(n,t,e){for(var r=0,o=n.length;r<o;++r)if(n[r].name===t){n[r]=p,n=n.slice(0,r).concat(n.slice(r+1));break}return null!=e&&n.push({name:t,value:e}),n}function a(n){return function(t,e){n(null==t?e:null)}}function c(n){var t=n.responseType;return t&&"text"!==t?n.response:n.responseText}function s(n){return new Function("d","return {"+n.map(function(n,t){return JSON.stringify(n)+": d["+t+"]"}).join(",")+"}")}function l(n,t){var e=s(n);return function(r,o){return t(e(r),o,n)}}function f(n){var t=Object.create(null),e=[];return n.forEach(function(n){for(var r in n)r in t||e.push(t[r]=r)}),e}n.prototype=t.prototype={constructor:n,has:function(n){return"$"+n in this},get:function(n){return this["$"+n]},set:function(n,t){return this["$"+n]=t,this},remove:function(n){var t="$"+n;return t in this&&delete this[t]},clear:function(){var n=this;for(var t in n)"$"===t[0]&&delete n[t]},keys:function(){var n=this,t=[];for(var e in n)"$"===e[0]&&t.push(e.slice(1));return t},values:function(){var n=this,t=[];for(var e in n)"$"===e[0]&&t.push(n[e]);return t},entries:function(){var n=this,t=[];for(var e in n)"$"===e[0]&&t.push({key:e.slice(1),value:n[e]});return t},size:function(){var n=this,t=0;for(var e in n)"$"===e[0]&&++t;return t},empty:function(){var n=this;for(var t in n)if("$"===t[0])return!1;return!0},each:function(n){var t=this;for(var e in t)"$"===e[0]&&n(t[e],e.slice(1),t)}};var p={value:function(){}};r.prototype=e.prototype={constructor:r,on:function(n,t){var e,r=this._,a=o(n+"",r),c=-1,s=a.length;{if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++c<s;)if(e=(n=a[c]).type)r[e]=i(r[e],n.name,t);else if(null==t)for(e in r)r[e]=i(r[e],n.name,null);return this}for(;++c<s;)if((e=(n=a[c]).type)&&(e=u(r[e],n.name)))return e}},copy:function(){var n={},t=this._;for(var e in t)n[e]=t[e].slice();return new r(n)},call:function(n,t){var e=arguments;if((r=arguments.length-2)>0)for(var r,o,u=new Array(r),i=0;i<r;++i)u[i]=e[i+2];if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(i=0,r=(o=this._[n]).length;i<r;++i)o[i].value.apply(t,u)},apply:function(n,t,e){if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(var r=this._[n],o=0,u=r.length;o<u;++o)r[o].value.apply(t,e)}};var h=function(n,r){function o(n){var t,e=h.status;if(!e&&c(h)||e>=200&&e<300||304===e){if(s)try{t=s.call(u,h)}catch(n){return void f.call("error",u,n)}else t=h;f.call("load",u,t)}else f.call("error",u,n)}var u,i,s,l,f=e("beforesend","progress","load","error"),p=t(),h=new XMLHttpRequest,v=null,d=null,m=0;if("undefined"==typeof XDomainRequest||"withCredentials"in h||!/^(http(s)?:)?\/\//.test(n)||(h=new XDomainRequest),"onload"in h?h.onload=h.onerror=h.ontimeout=o:h.onreadystatechange=function(n){h.readyState>3&&o(n)},h.onprogress=function(n){f.call("progress",u,n)},u={header:function(n,t){return n=(n+"").toLowerCase(),arguments.length<2?p.get(n):(null==t?p.remove(n):p.set(n,t+""),u)},mimeType:function(n){return arguments.length?(i=null==n?null:n+"",u):i},responseType:function(n){return arguments.length?(l=n,u):l},timeout:function(n){return arguments.length?(m=+n,u):m},user:function(n){return arguments.length<1?v:(v=null==n?null:n+"",u)},password:function(n){return arguments.length<1?d:(d=null==n?null:n+"",u)},response:function(n){return s=n,u},get:function(n,t){return u.send("GET",n,t)},post:function(n,t){return u.send("POST",n,t)},send:function(t,e,r){return h.open(t,n,!0,v,d),null==i||p.has("accept")||p.set("accept",i+",*/*"),h.setRequestHeader&&p.each(function(n,t){h.setRequestHeader(t,n)}),null!=i&&h.overrideMimeType&&h.overrideMimeType(i),null!=l&&(h.responseType=l),m>0&&(h.timeout=m),null==r&&"function"==typeof e&&(r=e,e=null),null!=r&&1===r.length&&(r=a(r)),null!=r&&u.on("error",r).on("load",function(n){r(null,n)}),f.call("beforesend",u,h),h.send(null==e?null:e),u},abort:function(){return h.abort(),u},on:function(){var n=f.on.apply(f,arguments);return n===f?u:n}},null!=r){if("function"!=typeof r)throw new Error("invalid callback: "+r);return u.get(r)}return u},v=function(n,t){return function(e,r){var o=h(e).mimeType(n).response(t);if(null!=r){if("function"!=typeof r)throw new Error("invalid callback: "+r);return o.get(r)}return o}};v("text/html",function(n){return document.createRange().createContextualFragment(n.responseText)});var d=v("application/json",function(n){return JSON.parse(n.responseText)});v("text/plain",function(n){return n.responseText}),v("application/xml",function(n){var t=n.responseXML;if(!t)throw new Error("parse error");return t});var m={},y={},g=34,w=10,k=13,b=function(n){function t(n,t){function e(){if(s)return y;if(l)return l=!1,m;var t,e,r=a;if(n.charCodeAt(r)===g){for(;a++<i&&n.charCodeAt(a)!==g||n.charCodeAt(++a)===g;);return(t=a)>=i?s=!0:(e=n.charCodeAt(a++))===w?l=!0:e===k&&(l=!0,n.charCodeAt(a)===w&&++a),n.slice(r+1,t-1).replace(/""/g,'"')}for(;a<i;){if((e=n.charCodeAt(t=a++))===w)l=!0;else if(e===k)l=!0,n.charCodeAt(a)===w&&++a;else if(e!==u)continue;return n.slice(r,t)}return s=!0,n.slice(r,i)}var r,o=[],i=n.length,a=0,c=0,s=i<=0,l=!1;for(n.charCodeAt(i-1)===w&&--i,n.charCodeAt(i-1)===k&&--i;(r=e())!==y;){for(var f=[];r!==m&&r!==y;)f.push(r),r=e();t&&null==(f=t(f,c++))||o.push(f)}return o}function e(t){return t.map(r).join(n)}function r(n){return null==n?"":o.test(n+="")?'"'+n.replace(/"/g,'""')+'"':n}var o=new RegExp('["'+n+"\n\r]"),u=n.charCodeAt(0);return{parse:function(n,e){var r,o,u=t(n,function(n,t){if(r)return r(n,t-1);o=n,r=e?l(n,e):s(n)});return u.columns=o,u},parseRows:t,format:function(t,e){return null==e&&(e=f(t)),[e.map(r).join(n)].concat(t.map(function(t){return e.map(function(n){return r(t[n])}).join(n)})).join("\n")},formatRows:function(n){return n.map(e).join("\n")}}},T=(b(","),b("\t"),function(n){var t,e="";return n.user?e+='\n<div class="schnack-form">\n    <textarea class="schnack-body"></textarea><br>\n    <button class="schnack-button">Send comment</button>\n</div>\n':e+='\n<button class="schnack-login-twitter">Login with Twitter to post comment</button>\n',e+='\n<ul class="schnack-comments">\n    ',n.comments.forEach(function(n){e+='\n        <li class="schnack-comment">\n            <div class="schnack-author">\n                '+(null==(t=n.name)?"":t)+' <span class="schnack-date">'+(null==(t=n.created_at_s)?"":t)+'</span>\n            </div>\n            <blockquote class="schnack-body">\n                <p>'+(null==(t=n.comment)?"":t)+"</p>\n            </blockquote>\n        </li>\n    "}),e+="\n</ul>"});!function(){function n(){d(u,function(e,r){e&&console.error(e),console.log(r),t(i).innerHTML=T(r),t(i+" .schnack-button").addEventListener("click",function(e){var r={comment:t(i+" .schnack-body").value};h(u).mimeType("application/json").header("Content-Type","application/json").post(JSON.stringify(r),function(t,e){t&&console.error(t),console.log(e),n()})})})}var t=function(n){return document.querySelector(n)},e=t("script[data-schnack-target]");if(!e)return console.warn("schnack script tag needs some data attributes");var r=e.dataset,o=r.schnackSlug,u=r.schnackHost+"/comments/"+o,i=r.schnackTarget;n()}()}();
