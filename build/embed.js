!function(){"use strict";var n="function"==typeof fetch?fetch.bind():function(n,e){return e=e||{},new Promise(function(t,s){function o(){var n,e=[],t=[],s={};return c.getAllResponseHeaders().replace(/^(.*?):\s*([\s\S]*?)$/gm,function(o,c,a){e.push(c=c.toLowerCase()),t.push([c,a]),n=s[c],s[c]=n?n+","+a:a}),{ok:1==(c.status/200|0),status:c.status,statusText:c.statusText,url:c.responseURL,clone:o,text:function(){return Promise.resolve(c.responseText)},json:function(){return Promise.resolve(c.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([c.response]))},headers:{keys:function(){return e},entries:function(){return t},get:function(n){return s[n.toLowerCase()]},has:function(n){return n.toLowerCase()in s}}}}var c=new XMLHttpRequest;c.open(e.method||"get",n);for(var a in e.headers)c.setRequestHeader(a,e.headers[a]);c.withCredentials="include"==e.credentials,c.onload=function(){t(o())},c.onerror=s,c.send(e.body)})},e=function(n){var e,t="";return n.user?t+='\n<div class="schnack-form">\n    <textarea class="schnack-body"></textarea><br>\n    <button class="schnack-button">Send comment</button>\n    (signed in as <span class="schnack-user">@'+(null==(e=n.user.name)?"":e)+"</span>)\n</div>\n":t+='\n<button class="schnack-signin-twitter">Login with Twitter to post comment</button>\n',t+='\n<ul class="schnack-comments">\n    ',n.comments.forEach(function(n){t+='\n        <li class="schnack-comment',n.approved||(t+=" schnack-not-approved"),t+='">\n            <div class="schnack-author">\n                '+(null==(e=n.name)?"":e)+' <span class="schnack-date">'+(null==(e=n.created_at_s)?"":e)+"</span>\n            </div>\n            ",n.approved||(t+='\n            <div class="schnack-awaiting-approval">\n                This comment is still waiting for approval by the site owner. Check back later.\n            </div>\n            '),t+='\n            <blockquote class="schnack-body">\n                <p>'+(null==(e=n.comment)?"":e)+"</p>\n            </blockquote>\n        </li>\n    "}),t+="\n</ul>"};!function(){function t(){n(i,{credentials:"include",headers:{"Content-Type":"application/json"}}).then(function(n){return n.json()}).then(function(o){console.log(o),s(l).innerHTML=e(o);var c=s(l+" .schnack-button"),a=s(l+" .schnack-signin-twitter");a&&a.addEventListener("click",function(n){window.open(u,"Twitter Sign-In","resizable,scrollbars,status,width=600,height=500")}),c&&c.addEventListener("click",function(e){var o={comment:s(l+" .schnack-body").value};n(i,{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).then(function(n){return n.json()}).then(function(n){console.log(n.json()),t()})})})}var s=function(n){return document.querySelector(n)},o=s("script[data-schnack-target]");if(!o)return console.warn("schnack script tag needs some data attributes");var c=o.dataset,a=c.schnackSlug,r=c.schnackHost,i=r+"/comments/"+a,u=r+"/auth/twitter",l=c.schnackTarget;t()}()}();
